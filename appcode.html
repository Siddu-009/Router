import React, { useState, useMemo } from "react";

// RouterUchi — single-file React component
// Tailwind CSS is used for styling (assumes Tailwind is configured in the project)
// Features:
// - State filter, search, station list
// - Station detail modal
// - Export filtered stations as CSV or DOC (simple Word-compatible blob)
// - Pagination

const DATA = [
  { state: "Telangana", stations: ["Hyderabad (HYB)", "Secunderabad (SC)", "Kazipet (KZJ)", "Warangal (WL)", "Kacheguda (KCG)"] },
  { state: "Andhra Pradesh", stations: ["Vijayawada (BZA)", "Visakhapatnam (VSKP)", "Tirupati (TPTY)", "Guntur (GNT)", "Rajahmundry (RJY)"] },
  { state: "Tamil Nadu", stations: ["Chennai Central (MAS)", "Chennai Egmore (MS)", "Coimbatore (CBE)", "Madurai (MDU)", "Salem (SA)"] },
  { state: "Kerala", stations: ["Thiruvananthapuram Central (TVC)", "Ernakulam Junction (ERS)", "Kozhikode (CLT)", "Kollam (QLN)", "Thrissur (TCR)"] },
  { state: "Karnataka", stations: ["Bengaluru City (SBC)", "Yesvantpur (YPR)", "Mysuru (MYS)", "Hubballi (UBL)", "Mangalore Central (MAQ)"] },
  { state: "Goa", stations: ["Madgaon (MAO)", "Vasco da Gama (VSG)", "Thivim (THVM)", "Karmali (KRMI)", "Pernem (PERN)"] },
  { state: "Odisha", stations: ["Bhubaneswar (BBS)", "Cuttack (CTC)", "Puri (PURI)", "Sambalpur (SBP)", "Rourkela (ROU)"] },
  { state: "Maharashtra", stations: ["Chhatrapati Shivaji Maharaj Terminus (CSMT)", "Mumbai Central (MMCT)", "Pune (PUNE)", "Nagpur (NGP)", "Nashik Road (NK)"] },
  { state: "Madhya Pradesh", stations: ["Bhopal (BPL)", "Habibganj / Rani Kamlapati (RKMP)", "Indore (INDB)", "Jabalpur (JBP)", "Gwalior (GWL)"] },
  { state: "Chhattisgarh", stations: ["Bilaspur Junction (BSP)", "Raipur (R)", "Durg (DURG)", "Korba (KRBA)", "Bhilai Power House (BPHB)"] },
  { state: "Bihar", stations: ["Patna Junction (PNBE)", "Patna Sahib (PNC)", "Gaya (GAYA)", "Bhagalpur (BGP)", "Muzaffarpur (MFP)"] },
  { state: "Rajasthan", stations: ["Jaipur (JP)", "Jodhpur (JU)", "Ajmer (AII)", "Kota (KOTA)", "Udaipur City (UDZ)"] },
  { state: "Uttar Pradesh", stations: ["Kanpur Central (CNB)", "Lucknow Charbagh (LKO)", "Varanasi (BSB)", "Prayagraj (PRYJ)", "Agra Cantt (AGC)"] },
  { state: "Uttarakhand", stations: ["Haridwar (HW)", "Dehradun (DDN)", "Rishikesh (RKSH)", "Haldwani (HDW)", "Kathgodam (KGM)"] },
  { state: "West Bengal", stations: ["Howrah (HWH)", "Sealdah (SDAH)", "Kolkata Chitpur (KOAA)", "Kharagpur (KGP)", "New Jalpaiguri (NJP)"] },
  { state: "Jharkhand", stations: ["Tatanagar (TATA)", "Dhanbad (DHN)", "Ranchi (RNC)", "Bokaro Steel City (BKSC)", "Chakradharpur (CKP)"] },
  { state: "Haryana", stations: ["Ambala Cantt (UMB)", "Panipat (PNP)", "Karnal (KUN)", "Kurukshetra (KKDE)", "Rohtak (ROK)"] },
  { state: "Punjab", stations: ["Amritsar (ASR)", "Ludhiana (LDH)", "Jalandhar City (JUC)", "Patiala (PTA)", "Bathinda (BTI)"] },
  { state: "Himachal Pradesh", stations: ["Kalka (KLK)", "Shimla (SML)"] },
  { state: "Gujarat", stations: ["Ahmedabad (ADI)", "Vadodara (BRC)", "Surat (ST)", "Rajkot (RJT)", "Valsad (BL)"] },
  { state: "Delhi (UT)", stations: ["New Delhi (NDLS)", "Old Delhi (DLI)", "Hazrat Nizamuddin (NZM)"] },
  { state: "Jammu & Kashmir", stations: ["Jammu Tawi (JAT)", "Shri Mata Vaishno Devi Katra (SVDK)", "Udhampur (UHP)"] },
  { state: "Assam", stations: ["Guwahati (GHY)", "Kamakhya (KYQ)", "Dibrugarh (DBRG)", "Silchar (SCL)", "New Tinsukia (NTSK)"] },
  { state: "Arunachal Pradesh", stations: ["Naharlagun (NHLN)", "Gumto (GMT)"] },
  { state: "Manipur", stations: ["Jiribam (JRBM)", "Khongsang (recent)", "Vangaichungpao (VNGP)"] },
  { state: "Meghalaya", stations: ["Mendipathar (MDPR)"] },
  { state: "Sikkim", stations: ["(Rangpo - under construction)"] },
  { state: "Mizoram", stations: ["(Sairang - under construction)"] },
  { state: "Nagaland", stations: ["Dimapur (DMV)", "Dhansiri", "Shokhuvi"] },
  { state: "Tripura", stations: ["Agartala (AGTL)", "Dharmanagar (DMR)", "Kumarghat (KUGT)", "Ambassa (ABSA)", "Sabroom (SBRM)"] },
  { state: "Puducherry", stations: ["Puducherry (PDY)", "Villianur (VIYR)"] },
];

export default function RouterUchiApp() {
  const [stateFilter, setStateFilter] = useState("All");
  const [query, setQuery] = useState("");
  const [page, setPage] = useState(1);
  const [selected, setSelected] = useState(null);

  const flattened = useMemo(() => {
    const list = [];
    DATA.forEach((s) => {
      s.stations.forEach((st) => list.push({ state: s.state, station: st }));
    });
    return list;
  }, []);

  const filtered = useMemo(() => {
    return flattened.filter((r) => {
      if (stateFilter !== "All" && r.state !== stateFilter) return false;
      if (query && !(`${r.station} ${r.state}`.toLowerCase().includes(query.toLowerCase()))) return false;
      return true;
    });
  }, [flattened, stateFilter, query]);

  const pageSize = 20;
  const totalPages = Math.ceil(filtered.length / pageSize) || 1;
  const pageData = filtered.slice((page - 1) * pageSize, page * pageSize);

  function downloadCSV(rows) {
    const header = ["State", "Station"];
    const csv = [header.join(",")].concat(rows.map(r => `${escapeCsv(r.state)},${escapeCsv(r.station)}`)).join("\n");
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "routeruchi_stations.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function escapeCsv(str){
    if(!str) return "";
    if(str.includes(',') || str.includes('\n') || str.includes('"')){
      return '"'+str.replace(/"/g,'""')+'"';
    }
    return str;
  }

  function downloadDoc(rows){
    // Simple .doc export (works in many word processors)
    const lines = rows.map(r => `${r.state} - ${r.station}`);
    const content = "RouterUchi Stations Export\n\n" + lines.join("\n");
    const blob = new Blob([content], { type: "application/msword" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'routeruchi_stations.doc';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-6xl mx-auto">
        <header className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-bold">RouterUchi — Rail Food Stations</h1>
            <p className="text-sm text-gray-600">Search, filter and export railway stations across India.</p>
          </div>
          <div className="flex gap-2">
            <button onClick={() => downloadCSV(filtered)} className="px-4 py-2 bg-blue-600 text-white rounded">Export CSV</button>
            <button onClick={() => downloadDoc(filtered)} className="px-4 py-2 bg-green-600 text-white rounded">Export Word</button>
          </div>
        </header>

        <div className="bg-white p-4 rounded shadow-sm">
          <div className="flex gap-3 items-center mb-4">
            <select value={stateFilter} onChange={(e)=>{setStateFilter(e.target.value); setPage(1);}} className="border p-2 rounded">
              <option>All</option>
              {DATA.map(s => <option key={s.state} value={s.state}>{s.state}</option>)}
            </select>
            <input value={query} onChange={(e)=>{setQuery(e.target.value); setPage(1);}} placeholder="Search station or state..." className="flex-1 border p-2 rounded" />
            <div className="text-sm text-gray-500">Total: {filtered.length}</div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
            {pageData.map((r, idx) => (
              <div key={idx} className="p-3 border rounded hover:shadow cursor-pointer" onClick={()=>setSelected(r)}>
                <div className="font-medium">{r.station}</div>
                <div className="text-sm text-gray-500">{r.state}</div>
              </div>
            ))}
          </div>

          <footer className="flex items-center justify-between mt-4">
            <div className="flex gap-2 items-center">
              <button disabled={page===1} onClick={()=>setPage(p=>Math.max(1,p-1))} className="px-3 py-1 border rounded disabled:opacity-50">Prev</button>
              <span>Page {page} / {totalPages}</span>
              <button disabled={page===totalPages} onClick={()=>setPage(p=>Math.min(totalPages,p+1))} className="px-3 py-1 border rounded disabled:opacity-50">Next</button>
            </div>
            <div className="text-sm text-gray-500">Showing {pageData.length} of {filtered.length}</div>
          </footer>
        </div>

        {/* Modal */}
        {selected && (
          <div className="fixed inset-0 bg-black/40 flex items-center justify-center" onClick={()=>setSelected(null)}>
            <div className="bg-white p-6 rounded max-w-md w-full" onClick={(e)=>e.stopPropagation()}>
              <h2 className="text-xl font-semibold mb-2">{selected.station}</h2>
              <p className="text-sm text-gray-600 mb-4">State: {selected.state}</p>
              <p className="text-sm">Here you can add more details like platform count, popularity, nearest food hubs, contact numbers and other metadata used by the RouterUchi food app.</p>
              <div className="mt-4 flex justify-end">
                <button onClick={()=>setSelected(null)} className="px-4 py-2 bg-blue-600 text-white rounded">Close</button>
              </div>
            </div>
          </div>
        )}

      </div>
    </div>
  );
}

/* -----------------------------------------------------------------------------
  Additional features added: Food Menus, Vendor Onboarding, Order Flow, Mapping API
  - Below are design notes and lightweight React components/pseudocode to extend
    the RouterUchi app with: 
      1) FoodMenus component (menu categories, items, modifiers, pricing, photos)
      2) VendorOnboarding flow (KYC, menu upload, bank details, operating hours)
      3) OrderFlow (cart, checkout, order states, notifications)
      4) Mapping API integration (map display, geocoding, routing, distance-based fees)

  These are intentionally compact and ready to be turned into production-ready
  components. You can copy the individual parts into separate files or keep them
  inside the single-file app for quick prototyping.

  -- FoodMenus (structure & UI notes) --
  - Data model: { id, vendorId, category, name, description, price, veg, imageUrl, modifiers[] }
  - UI: category tabs, search, item card with + to open modifiers modal, add-to-cart
  - Example minimal component (place inside same file or split):

  function FoodMenus({ vendorId, onAdd }) {
    // sample local state + sample data; in prod fetch from API
    const sampleCategories = ["Biryani", "Snacks", "Beverages"];
    const sampleItems = [
      { id: 'i1', category: 'Biryani', name: 'Chicken Biryani', price: 180, veg:false },
      { id: 'i2', category: 'Snacks', name: 'Masala Vada', price: 40, veg:true },
    ];
    return (
      <div>
        {/* category tabs + items grid */}
      </div>
    );
  }

  -- Vendor Onboarding (flow & checks) --
  Steps:
    1) Create account (email, mobile) + OTP verification
    2) KYC upload: business name, owner name, GST (optional), PAN, ID proof
    3) Bank details: account number, IFSC (for payouts)
    4) Menu upload: CSV/CSV template or manual entry (FoodMenus schema)
    5) Operating hours & delivery radius
    6) Approval dashboard: admin reviews and activates vendor

  Example pseudocode API endpoints:
    POST /api/vendor/register
    POST /api/vendor/verify-otp
    POST /api/vendor/kyc
    POST /api/vendor/menu/upload
    GET /api/vendor/status

  UI tips: show progress steps, allow draft menu saves, preview store page.

  -- Order Flow (frontend states & backend hooks) --
  Frontend states:
    CART -> CHECKOUT -> PAYMENT -> ORDER_PLACED -> DISPATCHED -> ON_ROUTE -> DELIVERED
  Key features:
    - Cart with modifiers and taxes
    - Delivery fee calculation (distance-based + surge)
    - Payment integrations: UPI, cards, wallets, COD
    - Real-time order status (Socket / Webhook) and SMS/Push notifications
    - Order history and refunds flow

  Minimal REST endpoints:
    POST /api/cart
    POST /api/checkout
    POST /api/payments/create
    POST /api/orders (webhooks to vendor & delivery partner)
    GET /api/orders/:id/status

  -- Mapping API (integration notes) --
  - Use Mapbox / Google Maps / HERE for maps & routing.
  - Functions needed:
      geocode(address) -> {lat,lng}
      reverseGeocode(lat,lng) -> address
      distance(origin,destination) -> km (routing)
      route(origin,destination) -> polyline
  - Delivery pricing: baseFee + perKm * distance; optionally time-window surcharge
  - Show vendor coverage area: polygon or circular radius

  Example client-side helper (pseudo):
    async function calcDeliveryFee(vendorLatLng, customerLatLng){
      const km = await routingDistanceKm(vendorLatLng, customerLatLng);
      const fee = 20 + km * 8; // sample formula
      return Math.max(fee, 25);
    }

  -- Security & Operational considerations --
  - Validate vendor KYC docs before accepting payouts
  - Rate-limit menu uploads and image sizes
  - PCI-compliant payment provider (avoid storing card details)
  - Use signed URLs for images (S3 / GCS) and CDN for performance
  - Logging, retries and alerting for failed webhooks

  -- Next steps I implemented into the canvas --
  - Added FoodMenus placeholder component outline
  - Added VendorOnboarding flow outline + example API list
  - Added OrderFlow states + minimal endpoints
  - Added Mapping API section with helper examples & fee calc
  - Added Export/CSV hooks already present; extended export to .doc is included

  If you'd like I can now:
    • Generate full React components (FoodMenus, VendorOnboarding, Cart, Checkout)
    • Add a simple Node/Express API mockup for the endpoints above
    • Add Mapbox/Google Maps integration example (with interactive demo)
    • Produce a PDF spec / SRS (software requirements) for developer handoff

  Tell me which of the above you want next — I will add it directly into the canvas.

  ----------------------------------------------------------------------------- */

